<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PwC Tax Sharing Agreement Generator</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #D04A02 0%, #ff6b35 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section h2 {
            color: #D04A02;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #D04A02;
            box-shadow: 0 0 0 3px rgba(208, 74, 2, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .member-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .member-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .member-info {
            flex: 1;
        }
        
        .member-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }
        
        .member-abn {
            font-size: 13px;
            color: #666;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #D04A02 0%, #ff6b35 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(208, 74, 2, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 8px 16px;
            font-size: 13px;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #D04A02;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Tax Sharing Agreement Generator</h1>
            <p>PwC Professional Document Generation Tool</p>
        </div>
        
        <div class="content">
            <div class="alert alert-success" id="successAlert"></div>
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-info" id="infoAlert"></div>
            
            <form id="tsaForm">
                <div class="section">
                    <h2>Head Company Details</h2>
                    <div class="form-group">
                        <label for="headCompanyName">Head Company Name *</label>
                        <input type="text" id="headCompanyName" required 
                               placeholder="e.g., ABC Holdings Pty Ltd">
                    </div>
                    <div class="form-group">
                        <label for="headCompanyABN">Head Company ABN *</label>
                        <input type="text" id="headCompanyABN" required 
                               placeholder="e.g., 12 345 678 901">
                    </div>
                    <div class="form-group">
                        <label for="headCompanyAddress">Head Company Address *</label>
                        <textarea id="headCompanyAddress" required 
                                  placeholder="123 Business Street, Sydney NSW 2000"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="headCompanyEmail">Head Company Email *</label>
                        <input type="email" id="headCompanyEmail" required 
                               placeholder="secretary@company.com.au">
                    </div>
                    <div class="form-group">
                        <label for="companySecretary">Company Secretary Name</label>
                        <input type="text" id="companySecretary" 
                               placeholder="John Smith">
                    </div>
                </div>

                <div class="section">
                    <h2>Agreement Details</h2>
                    <div class="form-group">
                        <label for="consolidationDate">Date of Consolidation *</label>
                        <input type="date" id="consolidationDate" required>
                    </div>
                    <div class="form-group">
                        <label for="groupType">Group Type *</label>
                        <select id="groupType" required>
                            <option value="consolidated">Consolidated Group</option>
                            <option value="mec">Multiple Entry Consolidated (MEC) Group</option>
                            <option value="mec-conversion">MEC Group (Special Conversion)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="allocationBasis">Allocation Basis for Item 3 *</label>
                        <select id="allocationBasis" required>
                            <option value="taxation">Notional Taxation Basis</option>
                            <option value="accounting">Notional Accounting Basis</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jurisdiction">Governing Law Jurisdiction *</label>
                        <select id="jurisdiction" required>
                            <option value="New South Wales">New South Wales</option>
                            <option value="Victoria">Victoria</option>
                            <option value="Queensland">Queensland</option>
                            <option value="South Australia">South Australia</option>
                            <option value="Western Australia">Western Australia</option>
                            <option value="Tasmania">Tasmania</option>
                        </select>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="hasPriorTSA">
                        <label for="hasPriorTSA">Has Prior Tax Sharing Agreement</label>
                    </div>
                </div>

                <div class="section">
                    <h2>Contributing Members</h2>
                    <div class="form-group">
                        <label for="memberName">Member Name</label>
                        <input type="text" id="memberName" placeholder="Member Company Name">
                    </div>
                    <div class="form-group">
                        <label for="memberABN">Member ABN</label>
                        <input type="text" id="memberABN" placeholder="12 345 678 901">
                    </div>
                    <div class="form-group">
                        <label for="memberAddress">Member Address & Email</label>
                        <textarea id="memberAddress" placeholder="Address and email"></textarea>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addMember()">
                        Add Member
                    </button>
                    
                    <div class="member-list" id="memberList" style="display: none;">
                        <h3 style="margin-bottom: 15px; color: #333;">Added Members:</h3>
                        <div id="membersContainer"></div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">
                        Generate TSA Document
                    </button>
                </div>
            </form>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 15px; color: #666;">Generating your document...</p>
            </div>
        </div>
    </div>

    <script>
        const members = [];

        function showAlert(type, message) {
            const alertId = type === 'success' ? 'successAlert' : 
                           type === 'error' ? 'errorAlert' : 'infoAlert';
            const alert = document.getElementById(alertId);
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        function addMember() {
            const name = document.getElementById('memberName').value.trim();
            const abn = document.getElementById('memberABN').value.trim();
            const address = document.getElementById('memberAddress').value.trim();

            if (!name || !abn) {
                showAlert('error', 'Please enter member name and ABN');
                return;
            }

            members.push({ name, abn, address });
            
            document.getElementById('memberName').value = '';
            document.getElementById('memberABN').value = '';
            document.getElementById('memberAddress').value = '';
            
            updateMemberList();
            showAlert('success', 'Member added successfully');
        }

        function removeMember(index) {
            members.splice(index, 1);
            updateMemberList();
            showAlert('info', 'Member removed');
        }

        function updateMemberList() {
            const container = document.getElementById('membersContainer');
            const listDiv = document.getElementById('memberList');
            
            if (members.length === 0) {
                listDiv.style.display = 'none';
                return;
            }
            
            listDiv.style.display = 'block';
            container.innerHTML = members.map((member, index) => `
                <div class="member-item">
                    <div class="member-info">
                        <div class="member-name">${member.name}</div>
                        <div class="member-abn">ABN: ${member.abn}</div>
                    </div>
                    <button type="button" class="btn btn-danger" onclick="removeMember(${index})">
                        Remove
                    </button>
                </div>
            `).join('');
        }

        document.getElementById('tsaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('tsaForm').style.display = 'none';
            
            try {
                const formData = {
                    headCompanyName: document.getElementById('headCompanyName').value,
                    headCompanyABN: document.getElementById('headCompanyABN').value,
                    headCompanyAddress: document.getElementById('headCompanyAddress').value,
                    headCompanyEmail: document.getElementById('headCompanyEmail').value,
                    companySecretary: document.getElementById('companySecretary').value || 'Company Secretary',
                    consolidationDate: document.getElementById('consolidationDate').value,
                    groupType: document.getElementById('groupType').value,
                    allocationBasis: document.getElementById('allocationBasis').value,
                    jurisdiction: document.getElementById('jurisdiction').value,
                    hasPriorTSA: document.getElementById('hasPriorTSA').checked,
                    members: members
                };

                generateTSA(formData);
                
                showAlert('success', 'TSA Document generated successfully!');
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', 'Error generating document: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('tsaForm').style.display = 'block';
            }
        });

        function generateTSA(data) {
            const consolidationDate = new Date(data.consolidationDate).toLocaleDateString('en-AU', {
                day: 'numeric', month: 'long', year: 'numeric'
            });
            
            // Generate Word document HTML with PwC styling
            const wordHTML = `
<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta charset="utf-8">
<title>Tax Sharing Agreement</title>
<style>
@page { 
    size: A4; 
    margin: 2.54cm 2.54cm 2.54cm 2.54cm; 
}
body {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 10pt;
    line-height: 14pt;
    color: black;
}
h1 {
    font-family: Georgia, serif;
    font-size: 11pt;
    font-weight: bold;
    margin-top: 18pt;
    margin-bottom: 9pt;
}
h2 {
    font-family: Georgia, serif;
    font-size: 10pt;
    font-weight: bold;
    font-style: italic;
    margin-top: 12pt;
    margin-bottom: 6pt;
}
h3 {
    font-family: Georgia, serif;
    font-size: 10pt;
    font-style: italic;
    margin-top: 6pt;
    margin-bottom: 6pt;
}
p {
    margin: 6pt 0;
}
table {
    border-collapse: collapse;
    width: 100%;
    margin: 12pt 0;
}
td, th {
    border: 0.5pt solid black;
    padding: 4pt;
    text-align: left;
    vertical-align: top;
}
.title {
    text-align: center;
    font-size: 14pt;
    font-weight: bold;
    margin: 24pt 0;
}
.subtitle {
    text-align: center;
    font-size: 12pt;
    font-weight: bold;
    margin: 12pt 0;
}
.center {
    text-align: center;
}
.page-break {
    page-break-before: always;
}
</style>
</head>
<body>

<p class="title">Tax Sharing Agreement</p>
<p class="subtitle">${data.headCompanyName}</p>
<p class="center">(ABN ${data.headCompanyABN})</p>
<p class="center" style="margin-top:24pt;"><strong>The Parties Listed in Schedule 1</strong></p>

<div class="page-break"></div>

<h1>Parties</h1>

<table>
<tr><td><strong>Name</strong></td><td><strong>${data.headCompanyName}</strong></td></tr>
<tr><td><strong>ABN</strong></td><td><strong>${data.headCompanyABN}</strong></td></tr>
<tr><td><strong>Description</strong></td><td><strong>Head Company</strong></td></tr>
<tr><td><strong>Notice details</strong></td><td>${data.headCompanyAddress}<br>E-mail: ${data.headCompanyEmail}<br>Attention: ${data.companySecretary}</td></tr>
</table>

<h1>Recitals</h1>
<p><strong>A.</strong> The Contributing Members and the Head Company are members of a ${data.groupType === 'mec' ? 'multiple entry consolidated' : 'consolidated'} group for Australian tax purposes formed originally with effect from ${consolidationDate}.</p>
<p><strong>B.</strong> Under section 721-15 of ITAA 1997, the Head Company and each of the Contributing Members are jointly and severally liable to pay a Group Liability if the Head Company were to fail to meet that Group Liability by the Due Date, unless the Group Liability is covered by a Tax Sharing Agreement.</p>
<p><strong>C.</strong> While acknowledging that the primary obligation to pay any Group Liability rests with the Head Company, the Group Members wish to enter into this Agreement to ensure that the Group Members are not jointly and severally liable for a Group Liability if the Head Company fails to pay such Group Liability by the relevant Due Date, and intend this Agreement to be a Tax Sharing Agreement.</p>
<p><strong>D.</strong> The Group Members have not entered into this Agreement as part of an arrangement with the purpose of prejudicing the recovery by the Commissioner of some or all of a Group Liability.</p>

<div class="page-break"></div>

<h1>PART A - INTERPRETATION</h1>
<h2>1. Interpretation</h2>
<h3>1.1 Definitions</h3>
<p>Unless otherwise defined in this Agreement, capitalised terms used in this Agreement which have a defined meaning in the ITAA have the same meaning in this Agreement.</p>
<p><strong>Agreement</strong> means this Tax Sharing Agreement and all schedules, annexures and attachments to it, as amended by the parties in accordance with its terms.</p>
<p><strong>Commissioner</strong> means the Federal Commissioner of Taxation of the Commonwealth of Australia or the Australian Taxation Office.</p>
<p><strong>Contribution Amount</strong> means the amount determined in accordance with Part B of this Agreement for each Group Member in relation to a Group Liability.</p>

<div class="page-break"></div>

<h1>PART B - ALLOCATION</h1>
<h2>2. Allocation of Group Liability</h2>
<h3>2.1 Consideration</h3>
<p>In consideration for the mutual promises set out in this Agreement, each Group Member agrees to be bound by the terms and conditions set out in this Agreement.</p>
<h3>2.2 Purpose</h3>
<p>The purpose of the allocation provisions is to reasonably allocate each Group Liability among the Group Members using the ${data.allocationBasis === 'taxation' ? 'Notional Taxation Basis' : 'Notional Accounting Basis'} as set out in Schedule 2.</p>

<div class="page-break"></div>

<h1>PART C - MISCELLANEOUS</h1>
<h2>11. Miscellaneous</h2>
<h3>11.5 Governing Law</h3>
<p>This Agreement is governed by the laws of ${data.jurisdiction}.</p>

<div class="page-break"></div>

<h1>Schedule 1 - Contributing Members</h1>
${members.length > 0 ? `
<table>
<tr><th>Member Name</th><th>ABN</th><th>Address</th></tr>
${members.map(m => `<tr><td>${m.name}</td><td>${m.abn}</td><td>${m.address}</td></tr>`).join('\n')}
</table>
` : '<p><em>No contributing members added</em></p>'}

<h1>Schedule 2 - Allocation Principles</h1>
<p>The Item 3 Tax-Related Liability will be allocated using the <strong>${data.allocationBasis === 'taxation' ? 'Notional Taxation Basis' : 'Notional Accounting Basis'}</strong> as set out in the complete PwC TSA template.</p>

</body>
</html>`;

            // Create and download the file
            const blob = new Blob(['\ufeff', wordHTML], {
                type: 'application/msword'
            });
            
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `TSA_${data.headCompanyName.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.doc`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
